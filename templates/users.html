<!-- templates/users.html -->
{% extends "base.html" %}

{% block title %}Select User to Compare - Spotify Profile Comparator{% endblock %}

{% block content %}
<h1>Select a User to Compare With</h1>

<!-- Time Range Selection -->
<div class="mb-4">
    <label for="timeRange">Select Timeframe for Comparison:</label>
    <select id="timeRange" class="form-control w-50">
        <option value="short_term">Last 4 Weeks</option>
        <option value="medium_term" selected>Last 6 Months</option>
        <option value="long_term">Several Years</option>
    </select>
</div>

{% if users %}
<ul class="list-group">
    {% for user in users %}
    <li class="list-group-item d-flex align-items-center">
        {% if user.profile_image %}
        <img src="{{ user.profile_image }}" alt="{{ user.username }}" width="50" class="mr-3">
        {% endif %}
        <span>{{ user.username }}</span>
        <!-- Compare Button with data-user-id -->
        <a href="{{ url_for('compare', user_id=user.id, time_range='medium_term') }}" class="btn btn-primary ml-auto compare-button" data-user-id="{{ user.id }}">Compare</a>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No other users available for comparison.</p>
{% endif %}
<p><a href="{{ url_for('dashboard') }}" class="btn btn-link">Back to Dashboard</a></p>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const timeRangeSelect = document.getElementById('timeRange');
        const compareButtons = document.querySelectorAll('.compare-button');
        
        function updateCompareLinks() {
            const selectedTimeRange = timeRangeSelect.value;
            compareButtons.forEach(button => {
                const userId = button.getAttribute('data-user-id');
                // Construct the new href with user_id and selected time_range
                const newHref = "{{ url_for('compare', user_id='USER_ID') }}".replace('USER_ID', userId) + `?time_range=${selectedTimeRange}`;
                button.setAttribute('href', newHref);
            });
        }
        
        // Initial update
        updateCompareLinks();
        
        // Update links when time range changes
        timeRangeSelect.addEventListener('change', updateCompareLinks);
    });
</script>
{% endblock %}
